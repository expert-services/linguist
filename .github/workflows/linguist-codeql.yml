name: GitHub Linguist for Actions

on:
  workflow_call:
    outputs:
      languages:
        description: "The languages linguist detected"
        value: ${{ jobs.detect-languages.outputs.languages }}
      testing:
        description: "testing"
        value: ${{ jobs.test-job.outputs.testing }}

jobs:
  detect-languages:
    runs-on: ubuntu-latest
    outputs:
      languages: ${{ steps.github-linguist.outputs.languages }}
    
    container:
      image: ghcr.io/expert-services/linguist@sha256:3dc698dc61745f7f022d2b7780c9d14c37c7447729963f29b715c09eaf394b46
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Execute github-linguist
        id: github-linguist
        shell: bash
        run: |
          chown -R root:root .
          export languages=$(github-linguist --json)
          echo "$languages"
          echo "languages=${languages}" >> $GITHUB_OUTPUT

  test-job:
    needs: [detect-languages]
    outputs:
      testing: ${{ steps.test.outputs.testing }}
    runs-on: ubuntu-latest
    steps:
      - name: print
        run: echo ${{ needs.detect-languages.outputs.languages }} 
      - name: test
        id: test
        run: echo "testing=testing" >> $GITHUB_OUTPUT
